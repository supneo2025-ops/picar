================================================================================
  iOS APP DEBUG CHECKLIST
================================================================================

Server Status: ‚úÖ WORKING (streaming 570+ frames)
Browser: ‚úÖ Should be working (test: http://192.168.100.148:5000/video)
iOS App: ‚ùå NOT WORKING - Let's debug!

================================================================================
  STEP 1: CHECK XCODE CONSOLE OUTPUT
================================================================================

When you run the iOS app, open Xcode console (bottom panel).

Look for these debug messages:

‚úÖ GOOD - Video streaming working:
  üìπ [VideoStream] Loading MJPEG stream from: http://192.168.100.148:5000/video
  üìπ [VideoStream] Stream task started
  üìπ [VideoStream] Received response: <NSHTTPURLResponse>
  üìπ [VideoStream] Status code: 200
  üìπ [VideoStream] Content-Type: multipart/x-mixed-replace; boundary=frame
  üìπ [VideoStream] Received 33789 bytes
  üñºÔ∏è [VideoStream] Decoded frame successfully
  ‚úÖ [VideoStream] First frame displayed!

‚ùå BAD - ATS blocking:
  üìπ [VideoStream] Loading MJPEG stream...
  ‚ùå [VideoStream] Error: App Transport Security has blocked...
  ‚ùå [VideoStream] Domain: NSURLErrorDomain, Code: -1003

  ‚Üí FIX: ATS settings not configured, go to Step 2

‚ùå BAD - Network timeout:
  üìπ [VideoStream] Loading MJPEG stream...
  ‚ùå [VideoStream] Error: The request timed out
  ‚ùå [VideoStream] Domain: NSURLErrorDomain, Code: -1001

  ‚Üí FIX: Server not responding, restart Pi server

‚ùå BAD - No logs at all:
  (Nothing appears in console)

  ‚Üí FIX: Console filter set wrong, or app crashed on launch

================================================================================
  STEP 2: VERIFY ATS SETTINGS IN XCODE
================================================================================

1. Click "PiCar" project (blue icon at top of Navigator)
2. Select "PiCar" TARGET (not project)
3. Click "Info" tab
4. Scroll down to "Custom iOS Target Properties"

YOU SHOULD SEE:
  ‚ñº App Transport Security Settings         Dictionary
      Allow Arbitrary Loads                 Boolean    YES
      Allows Local Networking               Boolean    YES
  Privacy - Local Network Usage...          String     (some text)

IF YOU DON'T SEE THIS:
  ‚Üí ATS settings not configured
  ‚Üí Follow XCODE_ATS_SETTINGS.txt to add them
  ‚Üí Clean Build Folder (Cmd+Shift+K)
  ‚Üí Build and Run again

================================================================================
  STEP 3: CHECK IP ADDRESS IN CODE
================================================================================

The app should be connecting to: 192.168.100.148:5000

To verify:
1. Open WebSocketClient.swift
2. Look for line ~15: static let PI_SERVER_IP = "192.168.100.148"
3. Make sure it matches your Pi's IP

To check Pi's actual IP:
  ssh pi@pi_local 'hostname -I'

If IPs don't match:
  ‚Üí Update PI_SERVER_IP in WebSocketClient.swift
  ‚Üí Build and Run again

================================================================================
  STEP 4: CHECK APP PERMISSIONS
================================================================================

iOS Simulator Settings:
1. In Simulator, go to Settings app
2. Scroll down to find "PiCar" app
3. Check permissions are granted

Required permissions:
  - Local Network ‚úÖ

================================================================================
  STEP 5: TEST WITH SIMPLEST POSSIBLE VIEW
================================================================================

If video still doesn't work, let's test if the issue is the MJPEG decoder.

In Xcode:
1. Run the app
2. Look at the video area
3. What do you see?

Scenarios:

A) Black screen with "Connecting to camera..."
   ‚Üí VideoStreamView is loading but never gets data
   ‚Üí Check Xcode console for errors
   ‚Üí Likely ATS or network issue

B) "Camera Unavailable" with retry button
   ‚Üí VideoStreamView detected an error
   ‚Üí Check Xcode console for error details
   ‚Üí Tap retry button, check console again

C) App crashes on launch
   ‚Üí Check Xcode console for crash log
   ‚Üí Look for red error messages

D) Video area is blank/white
   ‚Üí UI rendering issue
   ‚Üí Check MainView.swift is showing VideoStreamView

E) App shows video!
   ‚Üí üéâ It's working!

================================================================================
  STEP 6: COMMON FIXES
================================================================================

Fix 1: Clean and Rebuild
  Product > Clean Build Folder (Cmd+Shift+K)
  Product > Build (Cmd+B)
  Product > Run (Cmd+R)

Fix 2: Reset Simulator
  Device > Erase All Content and Settings
  Run app again

Fix 3: Check Server is Running
  ./restart_pi_server.sh
  Wait 5 seconds
  Run iOS app again

Fix 4: Use Different Simulator
  Try iPhone 15 Pro simulator
  iOS version 17 or later

Fix 5: Check Network
  Make sure Mac and Pi on same network
  Try: ping 192.168.100.148

================================================================================
  STEP 7: DETAILED DEBUGGING
================================================================================

Add temporary logging to ContentView.swift or MainView.swift:

In MainView.swift, add to body at the top:
  var body: some View {
    GeometryReader { geometry in
      ZStack {
        // ADD THIS LINE:
        Text("Debug: IP=\(WebSocketClient.PI_SERVER_IP):\(WebSocketClient.PI_SERVER_PORT)")
          .foregroundColor(.white)
          .position(x: 100, y: 50)

        // ... rest of code

This will show the IP address being used.

================================================================================
  WHAT TO SHARE FOR HELP
================================================================================

If none of the above works, please share:

1. Screenshot of Xcode console output
2. What you see in the app (screenshot)
3. Output of this command:
   ssh pi@pi_local 'tmux capture-pane -t car_backend -p' | tail -20

4. Confirmation:
   ‚òê Build succeeded (no errors)
   ‚òê App launches without crashing
   ‚òê Can see "Pi Car Controller" header
   ‚òê Can see joystick at bottom
   ‚òê Video area shows "Connecting to camera..."
   ‚òê Browser can see video at http://192.168.100.148:5000/video

================================================================================
  MOST LIKELY ISSUES
================================================================================

Based on your earlier screenshot showing build error:

90% chance: ATS settings not configured properly
  ‚Üí Check Step 2 above
  ‚Üí Settings must be in Info tab
  ‚Üí Values must be YES (not NO)

5% chance: Wrong IP address
  ‚Üí Check Step 3 above

5% chance: Server hung again
  ‚Üí Restart server
  ‚Üí Check browser can see video

================================================================================
  QUICK TEST
================================================================================

Right now, open these three things:

1. Browser window: http://192.168.100.148:5000/video
   Can you see video? YES / NO

2. Xcode console (bottom panel in Xcode)
   Any messages with "VideoStream"? YES / NO

3. iOS Simulator running PiCar app
   What does it show? _______________________

Share answers to these 3 questions for fastest help!

================================================================================
